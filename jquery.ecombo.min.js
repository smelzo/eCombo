(function(e){var b=function(g){return g.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()};var c=function(g,h,i){if(!i||i=="height"){h.css("height",e(g).css("height"))}if(!i||i=="width"){h.css("width",e(g).css("width"))}};var a=function(h,i){var g=jQuery.Event(h);e(this).trigger(g,i);return g};window.eCombo={};window.eCombo.defaultSettings={wrapperElementTag:"span",wrapperElementClass:"ecombo-wrapper",inputClass:"ecombo-input",buttons:true,buttonsPlacement:"right",buttonsPresentClass:"ecombo-with-button",newButtonClass:"btn ecombo-btn",newButtonHtml:"Add New",editButtonClass:"btn ecombo-edit",editButtonHtml:"Add",dismissButtonClass:"btn ecombo-dismiss",dismissButtonHtml:"Cancel",normalStateClass:"ecombo-state-normal",editStateClass:"ecombo-state-edit",useBootstrap:true,bootstrapIconNew:"icon-plus",bootstrapIconEdit:"icon-save",bootstrapIconDismiss:"icon-remove",tooltipsPlacement:"bottom",newOption:true,newOptionValue:"add-new",newOptionText:"Add New",newOptionClass:"ecombo-option-add-new",save:null,sortingResults:"ascending",responseParse:function(g){if(g.value==undefined){g.value="value"}if(g.text==undefined){g.text=g.value}return g},sortBy:"text",avoidDuplicates:true,duplicateMessage:"The record exists!",showEdit:function(g,h){},hideEdit:function(g,h){}};var d=function(h,g){var i=e.trim(e(this).text());e(this).attr("title",i);e(this).tooltip({placement:g.tooltipsPlacement});if(h){e(this).html('<i class="'+h+'"></i>')}};var f=function(h){var i=window.eCombo.defaultSettings;var g=function(){return e("<option></option>").attr("value",i.newOptionValue).addClass(i.newOptionClass).text(i.newOptionText)};return this.each(function(){var w=this,v=e(this),z=null,q=null,p=v.attr("multiple")?true:false,E={};if(h){e.extend(i,h)}e.each(i,function(H,I){var J=b(H);var G=v.attr("data-"+J)||null;if(!G){return}if(jQuery.inArray(G.toLowerCase(),["true","false"])>-1){G=(G=="true")}i[H]=G});e(this).data("settings",i);var B=function(){if(!i.newOption){return false}if(arguments.length){return(arguments[0]==i.newOptionValue)}return(v.val()==i.newOptionValue)};v.prepend(g());v.bind("showEdit",function(G,H){i.showEdit.call(v,G,H)});v.bind("hideEdit",function(G,H){i.hideEdit.call(v,G,H)});var u=document.createElement(i.wrapperElementTag);var z=jQuery(u).addClass(i.wrapperElementClass);ev=a.call(v,"beforeCreateInput",x);q=jQuery('<input type="text">').addClass(w.className).addClass(i.editStateClass).addClass(i.inputClass).hide();if(p){c(v,q,"width")}else{c(v,q)}v.addClass(i.normalStateClass).before(z);if((i.buttonsPlacement=="right")){z.append(q).append(v)}else{z.append(v).append(q)}var A=null,s=null,m=null;if(i.buttons){A=jQuery("<button></button>").addClass(i.newButtonClass).addClass(i.normalStateClass).html(i.newButtonHtml);if(i.useBootstrap){d.call(A,i.bootstrapIconNew,i)}var n=(i.buttonsPlacement=="right")?"insertAfter":"insertBefore";A[n](v);m=jQuery("<button></button>").addClass(i.dismissButtonClass).addClass(i.editStateClass).hide().html(i.dismissButtonHtml);if(i.useBootstrap){d.call(m,i.bootstrapIconDismiss,i)}m[n](A);s=jQuery("<button></button>").addClass(i.editButtonClass).addClass(i.editStateClass).hide().html(i.editButtonHtml);if(i.useBootstrap){d.call(s,i.bootstrapIconEdit,i)}s[n](A);z.addClass(i.buttonsPresentClass);z.addClass(i.buttonsPresentClass+"-"+i.buttonsPlacement)}var x={select:v,input:q,buttons:{newButton:A,editButton:s,dismissButton:m},wrapper:z};var F=function(){if(i.newOption&&v.children("option:first").is(":selected")){v.children("option:first:selected").removeAttr("selected");v.children("option:eq(1)").attr("selected","selected")}};var o=function(G){if(v.find('option[value="'+G+'"]').length){return true}return false};var k=function(){var G=a.call(v,"showEdit",x);if(!G.isDefaultPrevented()){z.find("."+i.editStateClass).show();z.find("."+i.normalStateClass).hide();q.val("").focus()}};var t=function(){var G=a.call(v,"hideEdit",x);if(!G.isDefaultPrevented()){z.find("."+i.editStateClass).hide();z.find("."+i.normalStateClass).show();F()}};var D=function(H){var J=function(L){var K=e(L)[(i.sortBy=="text"?"text":"val")]();return e.trim(K).toLowerCase()};var I=function(L,K){var N=J(L),M=J(K);if(N==M){return 0}else{if(i.sortingResults=="ascending"){return(N>M)?1:-1}else{return(N>M)?-1:1}}};var G=v.find("option").toArray();if(i.newOption){G.shift()}G.sort(I);e(G).remove().appendTo(v);if(e.isFunction(H)){H()}};var l=function(G){alert(G)};var y=function(H,I){if(I==undefined){I=H}var G=e("<option>").attr("value",H).text(I);v.append(G);if(i.sortingResults!="none"){D(function(){v.val(H)})}else{v.val(H)}};var r=function(){z.find('[disabled="disabled"]').removeAttr("disabled")};var j=function(){z.find("input,select,button").attr("disabled","disabled")};var C=function(I){var G=I,H=I;if(i.avoidDuplicates&&o(G)){l(i.duplicateMessage)}if(jQuery.isFunction(i.save)){j();i.save.call(v,I,function(J){if(!J){return}else{if(jQuery.isPlainObject(J)){J=i.responseParse(J);G=J.value;H=J.text}else{if(jQuery.isArray(J)){G=(J.length>=1)?J[0]:"";H=(J.length>=2)?J[1]:G}else{G=J;H=J}}}y(G,H);r();t()})}else{y(G,H);t()}};E.showEdit=function(){k()};E.hideEdit=function(){k()};E.addValue=function(H,G){y(H,G)};v.data("methods",E);v.keydown(function(H){if(H.keyCode>=37&&H.keyCode<=40||H.keyCode==13){return}var G=B();if(H.keyCode=="46"){if(!G){e(this).children("option:selected").remove()}return}});v.change(function(H){var G=B();if(G){H.preventDefault();k();return}});q.keyup(function(G){if(G.keyCode==27){G.preventDefault();t();return}else{if(G.keyCode==13){if(e(this).val()){C(e(this).val())}}}});q.blur(function(G){if(!e(this).val()){t();return}});s.click(function(G){G.preventDefault();if(q.val()){C(q.val())}return});A.click(function(G){G.preventDefault();k();return});m.click(function(G){G.preventDefault();t();return})})};e.fn.eCombo=function(g){if(typeof g==="string"){return this.each(function(){var h=e(this).data("methods");if(h[g]){h[g].apply(this,Array.prototype.slice.call(arguments,1))}})}else{if(typeof g==="object"||g==undefined){return f.apply(this,arguments)}else{e.error("Method "+g+" does not exist on jQuery.eCombo")}}}})(jQuery);